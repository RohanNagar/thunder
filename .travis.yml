language: java
jdk:
  - oraclejdk8

# Install npm for integration tests
addons:
  apt:
    packages:
    - npm

install:
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -V
  - npm --prefix scripts/ install

script:
  - mvn clean package jacoco:report coveralls:report
  - java -jar application/target/application-*.jar server test-config.yaml &
  - THUNDER_PID=$!
  - sleep 2 # Let Thunder start up
  - node scripts/src/test-runner.js
  - kill -9 $THUNDER_PID

# Restrict branch builds to master
branches:
  only:
    - master

env:
  global:
    - AWS_ACCESS_KEY_ID=1234567890
    - AWS_SECRET_ACCESS_KEY=1234567890
